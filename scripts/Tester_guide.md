# 智能按摩護理助手 - 自動化測試工具使用指南

## 🎯 這個工具做什麼？

這個工具會**自動模擬人類操作**你的 AI 護理助手 Web UI，測試每個功能是否正常工作。

### 自動測試的功能包括：

1. ✅ **設置按鈕** - 打開/關閉設置面板
2. ✅ **快速參數選擇** - 自動選擇部位、動作、力度、時長
3. ✅ **快速方案按鈕** - 測試預設方案
4. ✅ **執行按鈕** - 觸發按摩執行
5. ✅ **語音識別模式** - 切換 Browser/FunASR/Whisper
6. ✅ **知識庫管理** - 打開知識庫面板
7. ✅ **統計數據刷新** - 更新使用統計
8. ✅ **系統測試** - 觸發系統測試
9. ✅ **調試模式** - 啟用/關閉調試模式
10. ✅ **滑動條控制** - 調整延遲和超時設置
11. ✅ **喚醒詞功能** - 啟用/關閉喚醒詞
12. ✅ **按鈕可見性** - 檢查所有按鈕是否可見

---

## 📦 安裝依賴

```bash
# 安裝 Playwright (如果還沒安裝)
pip install playwright

# 安裝瀏覽器驅動
playwright install chromium
```

---

## 🚀 使用方法

### 方法 1: 基本測試 (推薦)

```bash
python3 nurse_assistant_tester.py
```

**效果:**
- ✅ 打開瀏覽器窗口 (你可以看到測試過程)
- ✅ 自動點擊所有按鈕和功能
- ✅ 測試60秒後自動停止
- ✅ 生成詳細測試報告

### 方法 2: 快速測試 (30秒)

```bash
python3 nurse_assistant_tester.py --duration 30
```

### 方法 3: 無頭模式 (後台運行)

```bash
python3 nurse_assistant_tester.py --headless
```

### 方法 4: 快速無頭測試

```bash
python3 nurse_assistant_tester.py --headless --duration 30
```

---

## 📺 測試過程會看到什麼？

```
🏥 智能按摩護理助手 - 自動化測試工具
============================================================
🖥️  GUI 模式 (可視化測試)
⏱️  測試時長: 60 秒
============================================================

🚀 正在啟動 server_qwen.py...
⏳ 等待服務器啟動...
✅ 服務器已就緒

🌐 正在打開瀏覽器...
📍 正在訪問 https://127.0.0.1:5000...
✅ 頁面加載成功

============================================================
🤖 開始自動化功能測試
============================================================

🧪 測試: 設置按鈕
   📋 設置面板已打開
   ✅ 設置按鈕 - 測試通過

🧪 測試: 快速參數選擇
   🎯 已選擇部位: 肩膀
   💆 已選擇動作: 按揉
   💪 已選擇力度: 適中
   ⏱️ 已選擇時長: 3分鐘
   ✅ 快速參數選擇 - 測試通過

🧪 測試: 快速方案
   ⚡ 快速方案已觸發
   ✅ 快速方案 - 測試通過

... (更多測試)

============================================================
🎉 自動化測試完成！
============================================================

📊 測試結果摘要:
------------------------------------------------------------
✅ 通過 設置按鈕
✅ 通過 快速參數選擇
✅ 通過 快速方案
✅ 通過 執行按鈕
✅ 通過 語音識別模式切換
❌ 失敗 知識庫管理
   錯誤: 找不到知識庫按鈕
... (更多結果)

------------------------------------------------------------
總計: 12 項測試
✅ 通過: 11
❌ 失敗: 1
成功率: 91.7%
```

---

## 📄 測試報告

測試完成後會自動生成報告文件:

```
test_report_20251023_143022.txt
```

報告內容包括:
- 🧪 測試結果摘要
- 🚨 檢測到的錯誤
- 📋 服務器日誌
- 🌐 瀏覽器控制台日誌

---

## 🔧 與 Claude Code 整合使用

### 方式 1: 直接運行測試

```bash
claude code "運行 nurse_assistant_tester.py 來測試我的護理助手"
```

### 方式 2: 測試後自動分析

```bash
# 1. 運行測試
python3 nurse_assistant_tester.py

# 2. 讓 Claude 分析結果
claude code "分析 test_report_*.txt 檔案,告訴我:
1. 哪些功能測試失敗了?
2. 錯誤的原因是什麼?
3. 如何修復這些錯誤?"
```

### 方式 3: 一條指令完成所有事

```bash
claude code "
1. 運行 nurse_assistant_tester.py 測試我的應用
2. 等它完成後,讀取生成的測試報告
3. 分析所有錯誤並給我修復建議
"
```

---

## 🎛️ 命令行參數

| 參數 | 說明 | 範例 |
|------|------|------|
| `--headless` | 無頭模式 (不顯示瀏覽器) | `--headless` |
| `--duration N` | 測試持續 N 秒 | `--duration 120` |

---

## 💡 使用技巧

### 技巧 1: 先用快速測試找問題

```bash
# 快速掃描 (30秒)
python3 nurse_assistant_tester.py --duration 30

# 看報告找到失敗的測試
# 然後再用完整測試確認
python3 nurse_assistant_tester.py --duration 120
```

### 技巧 2: 在開發時持續運行

```bash
# 在一個終端運行服務器
python3 server_qwen.py

# 在另一個終端運行測試
python3 nurse_assistant_tester.py --duration 300  # 5分鐘
```

### 技巧 3: CI/CD 自動化

```bash
# 在你的 CI 腳本中
python3 nurse_assistant_tester.py --headless --duration 60

# 檢查退出碼
if [ $? -ne 0 ]; then
    echo "測試失敗!"
    exit 1
fi
```

### 技巧 4: 對比測試結果

```bash
# 修改代碼前
python3 nurse_assistant_tester.py > before_test.log

# 修改代碼

# 修改代碼後
python3 nurse_assistant_tester.py > after_test.log

# 對比
diff before_test.log after_test.log
```

---

## 🐛 常見問題

### Q1: 瀏覽器無法打開?

**A:** 你可能在 WSL 環境中沒有 X11 服務器

**解決方案:**
```bash
# 使用無頭模式
python3 nurse_assistant_tester.py --headless
```

### Q2: 某些測試總是失敗?

**A:** 可能是:
1. UI 元素的 ID 改變了
2. 功能尚未實現
3. 載入時間不夠

**解決方案:**
- 查看測試報告中的具體錯誤信息
- 增加測試持續時間: `--duration 120`
- 手動測試該功能確認是否正常

### Q3: 如何只測試特定功能?

**A:** 編輯腳本,註釋掉不需要的測試:

```python
# 在 run_comprehensive_tests() 中
# self.test_feature("不想測試的功能", test_function)  # 註釋掉
```

### Q4: 測試太快/太慢?

**A:** 調整 `time.sleep()` 時間:
- 在腳本中搜索 `time.sleep()`
- 根據你的需求調整秒數

---

## 📊 測試報告範例

```
================================================================================
智能按摩護理助手 - 自動化測試報告
================================================================================
生成時間: 2025-10-23 14:30:22
測試模式: GUI模式
測試時長: 60 秒

🧪 測試結果:
--------------------------------------------------------------------------------
✅ 通過 設置按鈕
✅ 通過 快速參數選擇
✅ 通過 快速方案
✅ 通過 執行按鈕
✅ 通過 語音識別模式切換
❌ 失敗 知識庫管理
   錯誤: 找不到知識庫按鈕
✅ 通過 刷新統計
✅ 通過 系統測試
✅ 通過 調試模式切換
✅ 通過 滑動條控制
✅ 通過 喚醒詞功能
✅ 通過 按鈕可見性檢查

總計測試: 12
通過: 11
失敗: 1
成功率: 91.7%

🚨 檢測到 3 個錯誤:
--------------------------------------------------------------------------------
[TEST] 知識庫管理: 找不到知識庫按鈕
[BROWSER] [14:30:15] [BROWSER:error] TypeError: Cannot read property of undefined
[SERVER] [14:30:18] [SERVER] ERROR: Connection refused

📋 服務器日誌 (最近100行):
--------------------------------------------------------------------------------
[14:30:10] [SERVER] Server started on port 5000
[14:30:12] [SERVER] GET /health - 200 OK
[14:30:15] [SERVER] POST /api/chat - 200 OK
...

🌐 瀏覽器控制台日誌 (最近100行):
--------------------------------------------------------------------------------
[14:30:11] [BROWSER:log] Server config injected
[14:30:12] [BROWSER:log] Port connection successful (5000)
[14:30:15] [BROWSER:error] TypeError: Cannot read property of undefined
...
```

---

## 🎯 下一步

測試完成後:

1. **查看報告** - 打開 `test_report_*.txt`
2. **找出問題** - 關注 ❌ 失敗的測試
3. **分析錯誤** - 查看錯誤信息和日誌
4. **修復代碼** - 根據錯誤信息修復
5. **重新測試** - 確認問題已解決

或者,直接把報告給 Claude 分析:

```bash
claude code "讀取 test_report_20251023_143022.txt 並幫我修復所有錯誤"
```

---

## 🔗 相關工具

- `dev_monitor.py` - 開發監控工具 (手動測試 + 日誌收集)
- `nurse_assistant_tester.py` - 自動化測試工具 (自動點擊所有功能)

**建議工作流:**

```
開發階段 → 使用 dev_monitor.py (手動測試,實時查看日誌)
    ↓
測試階段 → 使用 nurse_assistant_tester.py (自動化功能測試)
    ↓
發現問題 → 使用 Claude 分析報告
    ↓
修復代碼 → 重新測試
```

---

好了! 開始自動化測試你的護理助手吧! 🚀

```bash
python3 nurse_assistant_tester.py
```